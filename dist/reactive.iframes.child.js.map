{"version":3,"sources":["reactive.iframes.child.ts"],"names":[],"mappings":"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","file":"reactive.iframes.child.js","sourcesContent":["\nmodule reactive.iframes {\n\n    const MessagePrefix = 'ReactiveIFrames';\n    const MessageDelimiter = '~';\n    const FrameIdAttributeName = 'data-frameid';\n    const FrameScriptId = 'iframe_child_script';\n\n    export class Child {\n        messageRegex : RegExp\n        id: string\n        parentWidth: number\n\n        constructor() {\n            var scriptTag = document.getElementById(FrameScriptId);\n            if (!scriptTag)\n                throw new Error('The ReactiveIFrames child script requires an id of \"' + FrameScriptId  + '\" on the <script> tag that included it');\n\n            if (!scriptTag.hasAttribute(FrameIdAttributeName))\n                throw new Error('The ReactiveIFrames child script requires a data attribute called \"' + FrameIdAttributeName + '\" on the <script> tag that included it');\n\n\n            this.id = scriptTag.getAttribute('data-frameid');\n\n            this.messageRegex = new RegExp('^' + MessagePrefix + MessageDelimiter + this.id + MessageDelimiter + '(\\\\S+)' + MessageDelimiter + '(.+)$');\n\n            window.addEventListener('message', this.processMessage.bind(this), false);\n\n            this.parentWidth = null;\n            this.sendMessage('height', this.currentHeight);\n        }\n\n        processMessage(event: Event) {\n\n            if (!(event instanceof MessageEvent) || typeof <MessageEvent>event.data !== 'string') {\n                return;\n            }\n            var messageData = <string>(<MessageEvent>event).data;\n\n            var match = messageData.match(this.messageRegex);\n\n            if (!match || match.length !== 3) { return; }\n\n            var key = match[1];\n            var value = match[2];\n            if (key === 'width') {\n                var width = parseInt(value);\n                //console.log(\"Parent -> \" + width + \" W Child (\" + this.id + \")\");\n                // Change the width if it's different.\n                if (width !== this.parentWidth) {\n                    this.parentWidth = width;\n                    this.sendMessage('height', this.currentHeight);\n                }\n            }\n        }\n\n        sendMessage(messageType: string, message: string) {\n            window.parent.postMessage(this.makeMessage(messageType, message), '*');\n        }\n\n        private makeMessage(messageType: string, message: string) {\n            var bits = [MessagePrefix, this.id, messageType, message];\n            return bits.join(MessageDelimiter);\n        }\n\n        get currentHeight() : string {\n            return document.body.offsetHeight.toString();\n        }\n\n        refresh() {\n            this.sendMessage('height', this.currentHeight);\n        }\n    }\n}\n\n(function () {\n    var oldWindowLoad = window.onload;\n    if (document.readyState === \"complete\") {\n        responsiveChild = new reactive.iframes.Child();\n    } else {\n        window.onload = function (e: Event) {\n            responsiveChild = new reactive.iframes.Child();\n            if (oldWindowLoad) {\n                oldWindowLoad(e);\n            }\n        };\n    }\n})();\n\nvar responsiveChild: reactive.iframes.Child;\n"]}